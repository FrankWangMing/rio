{"version":3,"file":"useInternalNode.js","sourceRoot":"","sources":["../../src/nodes/useInternalNode.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,kBAAkB,EAClB,wCAAwC,GACzC,MAAM,YAAY,CAAC;AACpB,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,MAAM,OAAO,CAAC;AAC5C,OAAO,SAAS,MAAM,gBAAgB,CAAC;AAEvC,OAAO,EAAE,WAAW,EAAE,MAAM,eAAe,CAAC;AAE5C,OAAO,EAAE,iBAAiB,EAAE,MAAM,6BAA6B,CAAC;AAGhE,MAAM,UAAU,eAAe,CAAW,OAA2B;IACnE,MAAM,OAAO,GAAG,UAAU,CAAC,WAAW,CAAC,CAAC;IACxC,SAAS,CAAC,OAAO,EAAE,wCAAwC,CAAC,CAAC;IAE7D,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;IAEhC,MAAM,EACJ,OAAO,EAAE,aAAa,EACtB,KAAK,EACL,UAAU,EAAE,gBAAgB,EAC5B,GAAG,SAAS,EACb,GAAG,iBAAiB,CACnB,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE,IAAI,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,OAAO,IAAI,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,CACxE,CAAC;IAEF,MAAM,UAAU,GAAG,OAAO,CACxB,GAAG,EAAE,CACH,kBAAkB,CAAC;QACjB,OAAO,EAAE,CAAC,GAAgB,EAAE,EAAE,CAAC,gBAAgB,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC;QAChE,IAAI,EAAE,CAAC,GAAgB,EAAE,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,CAAC;KAC3D,CAAC,EACJ,CAAC,gBAAgB,EAAE,EAAE,CAAC,CACvB,CAAC;IAEF,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,EAAE;QAC3B,OAAO;YACL,OAAO,EAAE,CAAC,EAAO,EAAE,YAAqB,EAAE,EAAE;gBAC1C,IAAI,YAAY,EAAE,CAAC;oBACjB,aAAa,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAC/D,CAAC;qBAAM,CAAC;oBACN,aAAa,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAChC,CAAC;YACH,CAAC;YACD,SAAS,EAAE,CAAC,EAAO,EAAE,YAAqB,EAAE,EAAE;gBAC5C,IAAI,YAAY,EAAE,CAAC;oBACjB,aAAa,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBACjE,CAAC;qBAAM,CAAC;oBACN,aAAa,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;gBAClC,CAAC;YACH,CAAC;YACD,SAAS,EAAE,CAAC,IAAa,EAAE,EAAE,CAAC,aAAa,CAAC,SAAS,CAAC,EAAE,EAAE,IAAI,CAAC;SAChE,CAAC;IACJ,CAAC,EAAE,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC,CAAC;IAExB,OAAO;QACL,GAAG,SAAS;QACZ,EAAE;QACF,OAAO;QACP,aAAa,EAAE,CAAC,CAAC,OAAO;QACxB,OAAO;QACP,UAAU;KACX,CAAC;AACJ,CAAC","sourcesContent":["import {\r\n  wrapConnectorHooks,\r\n  ERROR_USE_NODE_OUTSIDE_OF_EDITOR_CONTEXT,\r\n} from '@rioe/utils';\r\nimport { useMemo, useContext } from 'react';\r\nimport invariant from 'tiny-invariant';\r\n\r\nimport { NodeContext } from './NodeContext';\r\n\r\nimport { useInternalEditor } from '../editor/useInternalEditor';\r\nimport { Node } from '../interfaces';\r\n\r\nexport function useInternalNode<S = null>(collect?: (node: Node) => S) {\r\n  const context = useContext(NodeContext);\r\n  invariant(context, ERROR_USE_NODE_OUTSIDE_OF_EDITOR_CONTEXT);\r\n\r\n  const { id, related } = context;\r\n\r\n  const {\r\n    actions: EditorActions,\r\n    query,\r\n    connectors: editorConnectors,\r\n    ...collected\r\n  } = useInternalEditor(\r\n    (state) => id && state.nodes[id] && collect && collect(state.nodes[id])\r\n  );\r\n\r\n  const connectors = useMemo(\r\n    () =>\r\n      wrapConnectorHooks({\r\n        connect: (dom: HTMLElement) => editorConnectors.connect(dom, id),\r\n        drag: (dom: HTMLElement) => editorConnectors.drag(dom, id),\r\n      }),\r\n    [editorConnectors, id]\r\n  );\r\n\r\n  const actions = useMemo(() => {\r\n    return {\r\n      setProp: (cb: any, throttleRate?: number) => {\r\n        if (throttleRate) {\r\n          EditorActions.history.throttle(throttleRate).setProp(id, cb);\r\n        } else {\r\n          EditorActions.setProp(id, cb);\r\n        }\r\n      },\r\n      setCustom: (cb: any, throttleRate?: number) => {\r\n        if (throttleRate) {\r\n          EditorActions.history.throttle(throttleRate).setCustom(id, cb);\r\n        } else {\r\n          EditorActions.setCustom(id, cb);\r\n        }\r\n      },\r\n      setHidden: (bool: boolean) => EditorActions.setHidden(id, bool),\r\n    };\r\n  }, [EditorActions, id]);\r\n\r\n  return {\r\n    ...collected,\r\n    id,\r\n    related,\r\n    inNodeContext: !!context,\r\n    actions,\r\n    connectors,\r\n  };\r\n}\r\n"]}